<html>
	<head>
		<meta charset="utf-8">
		<meta title="Who Wants to be a Millionaire? - Controller">
		<title>(Beta) Who Wants to be a Millionaire? - Controller</title>
		<meta name="description" content="Who Wants to be a Millionaire? Quiz Edition for Desktop. This is the setup screen.">
		<link rel="stylesheet" type="text/css" href="style.css">
		<script src="functions.js"></script>
		<script>
			
			function onload(){
				sessionStorage.setItem("footertext2", "Coding and graphics by Samuel Kitson - Music from the TV show - Questions from various sources - Last modified on "+String(document.lastModified)+" - ");
				document.getElementById("footer").innerHTML = sessionStorage.getItem("footertext2")+"331 lines of code";
				localStorage.setItem("status", "idle");
				if (window.innerWidth > window.innerHeight*(3/2)) {
					document.getElementById("prizestable").style.fontSize = String(window.innerHeight/25);
				} else {
					document.getElementById("prizestable").style.fontSize = "3.5vw";
				};
				localStorage.setItem('prizes', '{"list": ["£100","£200","£300","£500","£1,000","£2,000","£4,000","£8,000","£16,000","£32,000","£64,000","£125,000","£250,000","£500,000","£1,000,000"]}');
				fillPrizesTable((JSON.parse(localStorage.getItem("prizes"))).list);
				fixPrizeHighlight();
				window.addEventListener("storage", storage_handler, false);
				function storage_handler(evt){
					console.log("Storage key "+evt.key+" was changed to "+evt.newValue);
					//alert("The new value for "+evt.key+" is "+evt.newValue);
					if (evt.key == "status" && evt.newValue == "answered") {
						console.log("Answer received");
						if (localStorage.getItem("answer") == "1" || localStorage.getItem("answer") == "3") {
							document.getElementById("answer"+String(localStorage.getItem("answer"))+"img").src = "images/millionaire small left orange.png";
						} else {
							document.getElementById("answer"+String(localStorage.getItem("answer"))+"img").src = "images/millionaire small right orange.png";
						};
					};
					if (evt.key == "prizetext") {
						document.getElementById("prizedetails").innerHTML = evt.newValue;
						setTimeout(function(){ document.getElementById("prizedetails").style.backgroundColor = localStorage.getItem("prizecolour"); }, 50);
						document.getElementById("prizedetails").style.display = "block";
					};
					if (evt.key == "audienceresults") {
						document.getElementById("audienceresults").style.display = "block";
						document.getElementById("audienceresults").innerHTML = evt.newValue;
					};
					if ((evt.key == "verifycode")&&(evt.newValue == sessionStorage.getItem("verifycodetempb"))) {
						localStorage.setItem("verifycode", code+"A");
					};
					if ((evt.key == "verifycode")&&(evt.newValue == sessionStorage.getItem("verifycodetempb")+"AA")) {
						document.getElementById("questiontext").innerHTML = "Screens synced<br>Waiting for controller to start...";
						localStorage.setItem("verifycode", sessionStorage.getItem("verifycodetempb")+"AAA");
					};
					if ((evt.key == "status")&&(evt.newValue == "idle")) {
						document.getElementById("audienceresults").style.display = "none";
						document.getElementById("phoneresults").style.display = "none";
						document.getElementById("prizedetails").style.display = "none";
						document.getElementById("lifeline5050").src = "images/millionaire 5050.png";
						document.getElementById("lifelinephone").src = "images/millionaire phone.png";
						document.getElementById("lifelineaudience").src = "images/millionaire audience.png";
						resetQuestion();
					};
					if (localStorage.getItem("status")!="idle") {
						if ((evt.key == "status")&&(evt.newValue == "start")) {
							document.getElementById("questiontext").innerHTML = "Who Wants to be a Millionaire?";
							document.getElementById("answer1text").innerHTML = "???";
							document.getElementById("answer2text").innerHTML = "???";
							document.getElementById("answer3text").innerHTML = "???";
							document.getElementById("answer4text").innerHTML = "???";
						};
						if (evt.key == "phonetext") {
							document.getElementById("phoneresults").style.display = "block";
							document.getElementById("phoneresults").innerHTML = localStorage.getItem("phonetext");
						};
						if ((evt.key == "lifeline5050")&&(evt.newValue == "used")) {
							document.getElementById("lifeline5050").src = "images/millionaire 5050 used.png";
						};
						if ((evt.key == "lifelinephone")&&(evt.newValue == "used")) {
							document.getElementById("lifelinephone").src = "images/millionaire phone used.png";
							if (localStorage.getItem("mode") == "quiz") {
								document.getElementById("countdown").style.display = "block";
							};
						};
						if ((evt.key == "lifelineaudience")&&(evt.newValue == "used")) {
							document.getElementById("lifelineaudience").src = "images/millionaire audience used.png";
						};
						if (evt.key == "timeleft") {
							document.getElementById("countdown").innerHTML = evt.newValue;
							if (evt.newValue == "0") {
								document.getElementById("countdown").style.display = "none";
							};
						};
						if (evt.key == "currentQuestion") {
							resetQuestion();
							highlightCurrentPrize(localStorage.getItem("current"));
							document.getElementById("questiontext").innerHTML = evt.newValue;
							document.getElementById("answer1text").innerHTML = localStorage.getItem("answer1text");
							document.getElementById("answer2text").innerHTML = localStorage.getItem("answer2text");
							document.getElementById("answer3text").innerHTML = localStorage.getItem("answer3text");
							document.getElementById("answer4text").innerHTML = localStorage.getItem("answer4text");
						};
						if (evt.key == "status" && evt.newValue == "revealed") {
							document.getElementById("phoneresults").style.display = "none";
							document.getElementById("audienceresults").style.display = "none";
							if (localStorage.getItem("correctAnswerNum") == "1" || localStorage.getItem("correctAnswerNum") == "3") {
								document.getElementById("answer"+localStorage.getItem("correctAnswerNum")+"img").src = "images/millionaire small left green.png";
							} else {
								document.getElementById("answer"+localStorage.getItem("correctAnswerNum")+"img").src = "images/millionaire small right green.png";
							};
						};
					};

				};
				
				var nums = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
				var code = String(nums[Math.floor(Math.random() * 10)] + nums[Math.floor(Math.random() * 10)] + nums[Math.floor(Math.random() * 10)] + nums[Math.floor(Math.random() * 10)] + nums[Math.floor(Math.random() * 10)]);
				sessionStorage.setItem("verifycodetempb", String(code));
				document.getElementById("questiontext").innerHTML = "Enter this code on the controller screen: "+code+"<br>Waiting for verification..."
				//alert("Enter this code on the controller screen: "+code+"\nPress the enter key to continue...");
			};
		</script>
	</head>
	<body ononline="online()" onoffline="offline()" onload="onload()" onresize="cheatDetected()" id="body">
		<div id="prizedetails"></div>
		<div id="audienceresults"></div>
		<div id="phoneresults"></div>
		<div id="audienceinput">
			<input type="text" id="audienceinput1" class="audienceinputboxes" placeholder="Votes for option A">
			<input type="text" id="audienceinput2" class="audienceinputboxes" placeholder="Votes for option B">
			<input type="text" id="audienceinput3" class="audienceinputboxes" placeholder="Votes for option C">
			<input type="text" id="audienceinput4" class="audienceinputboxes" placeholder="Votes for option D">
			<br>
			<button id="audienceinputbutton" onclick="audienceShow()">Show results</button>
		</div>
		<div id="countdown" onclick="countdown()">30</div>
		<button id="takemoneybutton" class="button" onclick="leave()">Leave with the money</button>
		<button id="newquestionbutton" class="button" onclick="loadQuestion('new')">Generate new question</button>
		<button id="loadquestionbutton" class="button" onclick="loadQuestion()">Load next question</button>
		<button id="resetbutton" class="button" onclick="resetGame()">Replay</button>
		<button id="revealanswerbutton" class="button" onclick="revealAnswer()">Reveal answer</button>
		<div id="syncfailed"><br>The pages failed to sync.<br>Please reload both and try again.</div>
		<select id="topicselect" onchange="resetRepeatData()">
			<option value="filler" disabled>Select a topic (175 questions in total)</option>
			<option value="records">World Records (NEW! - 65 questions)</option>
			<option value="general">General Knowledge (23 questions)</option>
			<option value="productdesign">Product Design GCSE - AQA (87 questions)</option>
		</select>
		<button id="modeselect" onclick="modeChange()"></button>
		<input type="text" id="codeinput" placeholder="Enter code from contestant page">
		<button id="entercodebutton" class="button" onclick="submitCode()">Sync pages<br><span style="font-size:0.9vw;">Leave the input box blank for single screen mode</span></button>
		<button id="startbutton" class="button" onclick="start()">Start game</button>
		<div id="nosignal">
			<img id="nosignalimg" src="images/millionaire no signal.png">
			<p id="nosignaltext">No signal<br>Reconnect to continue</p>
		</div>
		<!--<table id="lifelinestable">
			<tr>
				<td><img id="lifeline5050" class="lifelineimg" src="images/millionaire 5050.png" onclick="lifeline('5050')"></td>
				<td><img id="lifelinephone" class="lifelineimg" src="images/millionaire phone.png" onclick="lifeline('phone')"></td>
				<td><img id="lifelineaudience" class="lifelineimg" src="images/millionaire audience.png" onclick="lifeline('audience')"></td>
			</tr>
		</table>-->
		<table id="questiontable">
			<tr>
				<td colspan="2" id="questioncell">
					<div class="imgcontainer">
						<img src="images/millionaire large.png" class="tableimg">
						<div id="questiontext">CONTROLLER SCREEN</div>
					</div>
				</td>
			</tr>
			<tr>
				<td id="answer1cell">
					<div class="imgcontainer">
						<img onclick="selectans(1)" id="answer1img" src="images/millionaire small left.png" class="tableimg">
						<div onclick="selectans(1)" class="answertext answertextleft" id="answer1text"></div>
					</div>
				</td>
				<td id="answer2cell">
					<div class="imgcontainer">
						<img onclick="selectans(2)" id="answer2img" src="images/millionaire small right.png" class="tableimg">
						<div onclick="selectans(2)" class="answertext answertextright" id="answer2text"></div>
					</div>
				</td>
			</tr>
			<tr>
				<td id="answer3cell">
					<div class="imgcontainer">
						<img onclick="selectans(3)" id="answer3img" src="images/millionaire small left.png" class="tableimg">
						<div onclick="selectans(3)" class="answertext answertextleft" id="answer3text"></div>
					</div>
				</td>
				<td id="answer4cell">
					<div class="imgcontainer">
						<img onclick="selectans(4)" id="answer4img" src="images/millionaire small right.png" class="tableimg">
						<div onclick="selectans(4)" class="answertext answertextright" id="answer4text"></div>
					</div>
				</td>
			</tr>
		</table>
		<table id="prizestable">
			<tr>
				<td><a id="prizes15A" class="prizesA"></a></td>
				<td><a id="prizes15B" class="prizesB"></a></td>
				<td><a id="prizes15C" class="prizesC"></a></td>
			</tr>
		</table>
		<p id="footer">Coding and graphics by Samuel Kitson - Music from the TV show - Questions from various sources</p>
	</body>
</html>
